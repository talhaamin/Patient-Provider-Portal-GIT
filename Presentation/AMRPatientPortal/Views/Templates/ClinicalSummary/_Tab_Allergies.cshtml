@model IEnumerable<AMR.Models.AllergyModel>
@using System.Text;
@using System.Web.Script.Serialization;

<table class="box-table-a" id="tab-Allergies" summary="Appointments">
                                        <thead>
                                            <tr>
                                                <th scope="col">Effective Date</th>
                                                <th scope="col">Allergen Type</th>
                                                <th scope="col">Allergen</th>
                                                <th scope="col">Reaction</th>                                               
                                                <th scope="col">Status</th>
                                                <th scope="col" style="text-align:center;" class="showHideThisAllergy">Edit</th>
                                                <th scope="col" style="text-align:center;">Details</th>
                                                <th scope="col" style="text-align:center;" class="showHideThisAllergy">Delete</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                     <tbody>
                                            @if (Model != null && Model.Count() > 0)
                                            {
                                                int counter=0;
                                                foreach (var item in Model)
                                                {
                                                    
                                                    StringBuilder jsonStringAllergy = new StringBuilder();

                                                    jsonStringAllergy.Append(" { ");
                                                    jsonStringAllergy.Append("\"PatFamilyHistCntr\": \"" + item.PatientAllergyCntr + "\",");
                                                    jsonStringAllergy.Append("\"EffectiveDate\": \"" + item.EffectiveDate + "\",");
                                                    jsonStringAllergy.Append("\"AllergenType\":  \"" + item.AllergenType + "\",");
                                                    jsonStringAllergy.Append("\"Allergen\":  \"" + item.Allergen + "\",");
                                                    jsonStringAllergy.Append("\"Reaction\":  \"" + item.Reaction + "\",");
                                                    jsonStringAllergy.Append("\"Note\":  \"" + item.Note + "\",");
                                                    jsonStringAllergy.Append("\"ConditionStatusId\":  \"" + (item.ConditionStatusId) + "\"");
                                                    jsonStringAllergy.Append("}");
                                                    
                                                
                                                    //var jsonStr = new JavaScriptSerializer().Serialize(item);
                                                
                                                    <tr class="@((counter % 2 == 0) ? "r1" : "r0")">
                                                        @{
                                                            DateTime dtexDate;
                                                            if (item.EffectiveDate.Length == 8 && DateTime.TryParseExact(item.EffectiveDate, "yyyyMMdd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None, out dtexDate))
                                                            {
                                                                DateTime dtEff = DateTime.ParseExact(item.EffectiveDate, "yyyyMMdd", null);
                                                                string s = dtEff.ToString("MM/dd/yyyy");

                                                                <td width="20%"><input type="hidden" id="@(item.PatientAllergyCntr)" value="@jsonStringAllergy.ToString()" />@s</td>
                                                            }
                                                            else if ((item.EffectiveDate).Trim().Length == 6)
                                                            {
                                                                string strYear = item.EffectiveDate.Substring(0, 4);
                                                                string strMonth = item.EffectiveDate.Substring(4, 2);
                                                                string strEffectiveDate = strMonth + "/" + strYear;
                                                                   <td width="20%"><input type="hidden" id="@(item.PatientAllergyCntr)" value="@jsonStringAllergy.ToString()" />@strEffectiveDate</td>
                                                            }
                                                            else
                                                            {
                                                                <td widtha="20%"><input type="hidden" id="@(item.PatientAllergyCntr)" value="@jsonStringAllergy.ToString()" />@item.EffectiveDate</td>
                                                            }
                                                         }
                                                    
                                                        <td>@item.AllergenType</td>
                                                        <td>@item.Allergen</td>
                                                        <td>@item.Reaction</td>                                                       
                                                        <td>@item.ConditionStatus</td>
                                                        <td align="center" class="showHideThisAllergy">  <img onclick="allergyEdit(@item.PatientAllergyCntr);"   src="Content/img/edit.png" /> </td>
                                                        <td align="center">  <img  onclick="allergyDetails(@item.PatientAllergyCntr);"   src="Content/img/details.png" />  </td>
                                                        <td align="center" class="showHideThisAllergy">  <img  onclick="allergyDelete(@item.PatientAllergyCntr);"   src="Content/img/delete.png" />  </td>
                                                  </tr>
                                                    counter++;
                                                }
                                            }
                                            else
                                            {
                                                <tr>
                                <td width="200px;">No Information Available.</td>
                            </tr>
                                            }
                                     </tbody>
</table>

