@model IEnumerable<AMR.Models.AllergyModel>
@using System.Text;
<table class="box-table-a" id="tbl-Allergies" summary="Allergies">
                    <thead>
                        <tr>
                        <th scope="col" style="vertical-align:middle"><span style="margin-left:2px;">Effective Date</span></th>                        
                        <th scope="col" style="vertical-align:middle">Allergen</th>                                                
                        <th scope="col" style="vertical-align:middle">Status</th>
                                              
                       </tr>
                    </thead>
                   <tbody>
                  @if (Model!=null && Model.Count()>0)
                  {
                      int counter=0;
                      foreach (var item in Model)
                        {
                            StringBuilder jsonStringAllergy = new StringBuilder();

                            jsonStringAllergy.Append(" { ");
                            jsonStringAllergy.Append("\"PatAllergyCntr\": \"" + item.PatientAllergyCntr + "\",");
                            jsonStringAllergy.Append("\"EffectiveDate\": \"" + item.EffectiveDate + "\",");
                            jsonStringAllergy.Append("\"AllergenType\":  \"" + item.AllergenType + "\",");
                            jsonStringAllergy.Append("\"Allergen\":  \"" + item.Allergen + "\",");
                            jsonStringAllergy.Append("\"Reaction\":  \"" + item.Reaction + "\",");
                            jsonStringAllergy.Append("\"Note\":  \"" + item.Note + "\",");
                            jsonStringAllergy.Append("\"ConditionStatusId\":  \"" + (item.ConditionStatusId) + "\"");
                            jsonStringAllergy.Append("}");
                            <tr class="@((counter % 2 == 0) ? "r1" : "r0")" onclick="OpenAllergiesRecords(@item.PatientAllergyCntr);">
                             @{
                                DateTime dtexDate;
                                if (item.EffectiveDate.Length == 8 && DateTime.TryParseExact(item.EffectiveDate, "yyyyMMdd", System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None, out dtexDate))
                                {
                                    DateTime dtEff = DateTime.ParseExact(item.EffectiveDate, "yyyyMMdd", null);
                                    string s = dtEff.ToString("MM/dd/yyyy");

                                    <td style="vertical-align:middle"><input type="hidden" id="Allergies-@item.PatientAllergyCntr" value="@jsonStringAllergy.ToString()" />@s</td>
                                }
                                else if ((item.EffectiveDate).Trim().Length == 6)
                                {
                                    string strYear = item.EffectiveDate.Substring(0, 4);
                                    string strMonth = item.EffectiveDate.Substring(4, 2);
                                    string strEffectiveDate = strMonth + "/" + strYear;
                                        <td style="vertical-align:middle"><input type="hidden" id="Allergies-@item.PatientAllergyCntr" value="@jsonStringAllergy.ToString()" />@strEffectiveDate</td>
                                }
                                else
                                {
                                    <td style="vertical-align:middle"><input type="hidden" id="Allergies-@item.PatientAllergyCntr" value="@jsonStringAllergy.ToString()" />@item.EffectiveDate</td>
                                }
                            } 
                            <td style="vertical-align:middle"><span >@item.Allergen </span></td>                            
                            <td style="vertical-align:middle"><span >@item.ConditionStatus</span></td>
                            </tr>
                            counter++;   
                        }
                  }
                  else
                  {
                       <tr>
                                <td width="200px;">No Information Available.</td>
                            </tr>
                      
                  }
                    </tbody>
</table>

