@using AMR.Models;
@using AMR.Core.Extensions;
@using System.Text;
@model MessageCenterModel

@{
    ViewBag.Title = "[Patient Portal] Referrals";

    Layout = "~/Views/Shared/_LayoutMasterPage.cshtml";
}
@section Scripts
{
    <script>
        $(document).ready(function () {
            alert('test');
            $('#tbl-Refferals').fixedHeaderTable();
        });
    </script>
    <script>
        // start of request referal button script

        $(function () {

            tips = $(".validateTips");



            $("#reqbtn-form").dialog({
                autoOpen: false,
                show: {
                    effect: "blind",
                    duration: 1000
                },
                hide: {
                    effect: "blind",
                    duration: 1000
                },

                width: 850,
                modal: true,
                buttons: {
                    //"Save": function () {
                    //    var bValid = true;



                    //    function chkStr(value) {
                    //        var str;
                    //        if (value == true) {
                    //            str = '1';
                    //            return str;
                    //        }
                    //        else if (value == false) {
                    //            str = '0';
                    //            return str;
                    //        }
                    //    };
                    //    var PreferredPeriod1 = chkStr($('#chkRmor').prop('checked'));
                    //    PreferredPeriod1 += chkStr($('#chkRaft').prop('checked'));
                    //    PreferredPeriod1 += chkStr($('#chkReve').prop('checked'));

                    //    var PreferredWeekDay1 = chkStr($('#chkRmon').prop('checked'));
                    //    PreferredWeekDay1 += chkStr($('#chkRtue').prop('checked'));
                    //    PreferredWeekDay1 += chkStr($('#chkRwed').prop('checked'));
                    //    PreferredWeekDay1 += chkStr($('#chkRthu').prop('checked'));
                    //    PreferredWeekDay1 += chkStr($('#chkRfri').prop('checked'));


                    //    if (bValid) {
                    //        //ajax 
                    //        try {


                    //            var requestData = {
                    //                //FacilityId: $.trim($('#cmbAppointmentFacility1').val()),
                    //                ProviderId_To: $.trim($('#cmbRProvider').val()),
                    //                // ProviderId_Appointment: $.trim($('#cmbAppointmentDoctor1').val()),
                    //                MessageUrgencyId: $.trim($('#cmbRMessageUrgency').val()),
                    //                PreferredPeriod: PreferredPeriod1,
                    //                PreferredWeekDay: PreferredWeekDay1,

                    //                AppointmentStart: $.trim($('#txtRpredatefrom').val()),
                    //                AppointmentEnd: $.trim($('#txtRpredateto').val()),
                    //                PreferredTime: $.trim($('#cmbRprefTime option:selected').text()),
                    //                VisitReason: $.trim($('#txtReqRes').val()),
                    //                MessageRequest: $.trim($('#txtRComm').val())

                    //            };


                    //            $.ajax({
                    //                type: 'POST',
                    //                url: 'index-RequestReferral-save',
                    //                data: JSON.stringify(requestData),
                    //                dataType: 'json',
                    //                contentType: 'application/json; charset=utf-8',
                    //                success: function (data) {
                    //                    // if success
                    //                    // alert("Success : " + data);
                    //                    // $("#immunization-portlet").html(data);
                    //                    //$("#Appointment-portlet").html(data);
                    //                    alert(data);

                    //                },
                    //                error: function (xhr, ajaxOptions, thrownError) {
                    //                    //if error

                    //                    alert('Error : ' + xhr.message);
                    //                    HideLoader();
                    //                },
                    //                complete: function (data) {
                    //                    // if completed
                    //                    HideLoader();

                    //                },
                    //                async: true,
                    //                processData: false
                    //            });
                    //        } catch (err) {

                    //            if (err && err !== "") {
                    //                alert(err.message);
                    //                HideLoader();
                    //            }
                    //        }
                    //        $(this).dialog("close");
                    //        ShowLoader();


                    //        //                        end ajax


                    //    }
                    //},
                    Close: function () {
                        $(this).dialog("close");
                    }
                },
                close: function () {

                }
            });
            $("#createreqbtn")
            .button()
            .click(function () {
                $("#reqbtn-form").dialog("open");
            });
        });

        //- end of request referal button script


        $(function () {
            $("input[type=submit], a, button")
            .button()
            .click(function (event) {
                // event.preventDefault();
            });
        });


        $(document).ready(function () {

            // Call horizontalNav on the navigations wrapping element
            $('.full-width').horizontalNav(
                 {
                     responsive: false

                 });
        });

        function checkAll(checkId) {
            var inputs = document.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].type == "checkbox" && inputs[i].id == checkId) {
                    if (inputs[i].checked == true) {
                        inputs[i].checked = false;
                    } else if (inputs[i].checked == false) {
                        inputs[i].checked = true;
                    }
                }
            }
        }

        


        function ReferralDetail(id) {
           // alert(id);
                try {
                    var obj = jQuery.parseJSON($("#hdReferralDetails" + id).val());


                    function chkstr(value) {
                        if (value == '0') {
                            return false;
                        }
                        if (value == '1')
                            return true;
                    }
                   // $('#cmbAppointmentFacility1').val($.trim(obj.FacilityId));
                    $('#cmbRProvider').val($.trim(obj.ProviderId_To));
                    $('#chkRmor').prop('checked', chkstr(obj.PreferredPeriod[0]));
                    $('#chkRaft').prop('checked', chkstr(obj.PreferredPeriod[1]));
                    $('#chkReve').prop('checked', chkstr(obj.PreferredPeriod[2]));
                    $('#cmbRMessageUrgency').val($.trim(obj.MessageUrgencyId));
                    $('#chkRmon').prop('checked', chkstr(obj.PreferredWeekDay[0]));
                    $('#chkRtue').prop('checked', chkstr(obj.PreferredWeekDay[1]));
                    $('#chkRwed').prop('checked', chkstr(obj.PreferredWeekDay[2]));
                    $('#chkRthu').prop('checked', chkstr(obj.PreferredWeekDay[3]));
                    $('#chkRfri').prop('checked', chkstr(obj.PreferredWeekDay[4]));
                    $('#txtRpredatefrom').val($.trim(obj.AppointmentStart));
                    $('#txtRpredateto').val($.trim(obj.AppointmentEnd));
                    $('#cmbRprefTime option:selected').text($.trim(obj.PreferredTime));
                    $('#txtReqRes').val($.trim(obj.VisitReason));
                    $('#txtRComm').val($.trim(obj.MessageRequest));


                   // $('#cmbAppointmentFacility1').attr("disabled", true);
                    $('#cmbRProvider').attr("disabled", true);
                    $('#chkRmor').attr("disabled", true);
                    $('#chkRaft').attr("disabled", true);
                    $('#chkReve').attr("disabled", true);
                    $('#cmbRMessageUrgency').attr("disabled", true);
                    $('#chkRmon').attr("disabled", true);
                    $('#chkRtue').attr("disabled", true);
                    $('#chkRwed').attr("disabled", true);
                    $('#chkRthu').attr("disabled", true);
                    $('#chkRfri').attr("disabled", true);
                    $('#txtRpredatefrom').attr("disabled", true);
                    $('#txtRpredateto').attr("disabled", true);
                    $('#cmbRprefTime').attr("disabled", true);
                    $('#txtReqRes').attr("disabled", true);
                    $('#txtRComm').attr("disabled", true);

                } catch (e) {
                    alert(e.message);
                }
                $("#reqbtn-form").dialog("open");
        }
        function ReferralDelete(id) {
            alert(id);
        }
    </script>
}

<!--pop up of Request Referral button -->
<div id="reqbtn-form" title="Detail Referral Request">
    <table width="100%" height="398" border="0" cellpadding="0" cellspacing="2">
        <tr>
            <td width="250" height="35" align="right">Send Request to :</td>
            <td width="2">&nbsp;</td>
            <td width="571">
                <label for="cname_txt"></label>
                   @Html.DropDownList("cmbRProvider", Model.Providers.ToProviderModelSelectList(), new { @class = " txt  ui-corner-all bcom", style = "width:400px;", id = "cmbRProvider" })
         </td>
        </tr>
        <tr>
            <td width="250" height="35" align="right">Reason for Request :</td>
            <td align="right">&nbsp;</td>
            <td>
                <input type="text" name="reas_txt3" id="txtReqRes" class="btxt" /></td>
        </tr>
        <tr>
            <td width="250" height="35" align="right">Comments :</td>
            <td>&nbsp;</td>
            <td>
                <textarea name="comm_txta2" cols="45" rows="5" class="btxta" id="txtRComm"></textarea></td>
        </tr>
        <tr>
            <td width="250" height="35" align="right">Preferred Period  :</td>
            <td>&nbsp;</td>
            <td>
                <table width="439" border="0" cellpadding="0" cellspacing="0">
                    <tr>
                        <td width="21">
                            <input type="checkbox" name="mor_chk2" id="chkRmor" /></td>
                        <td width="50">Morning</td>
                        <td width="21">
                            <input type="checkbox" name="aft_chk2" id="chkRaft" /></td>
                        <td width="66">Afternoon</td>
                        <td width="21">
                            <input type="checkbox" name="eve_chk2" id="chkReve" /></td>
                        <td width="82">Evening</td>
                        <td width="59">Urgency:</td>
                        <td width="119">
                             @Html.DropDownList("cmbRMessageUrgency", Model.MessageUrgencyType.ToMessageUrgencySelectList(), new { @class = "txt  ui-corner-all bcom", style = "width:120px; margin-left:20px;", id = "cmbRMessageUrgency" })
                          </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td width="250" height="35" align="right">Week Day :</td>
            <td>&nbsp;</td>
            <td>
                <table width="445" border="0" cellpadding="0" cellspacing="0">
                    <tr>
                        <td width="22">
                            <input type="checkbox" name="mon_chk" id="chkRmon" /></td>
                        <td width="51">Monday</td>
                        <td width="22">
                            <input type="checkbox" name="tue_chk" id="chkRtue" /></td>
                        <td width="63">Tuesday</td>
                        <td width="22">
                            <input type="checkbox" name="wed_chk" id="chkRwed" /></td>
                        <td width="72">Wednesday</td>
                        <td width="22">
                            <input type="checkbox" name="thu_chk" id="chkRthu" /></td>
                        <td width="70">Thursday</td>
                        <td width="22">
                            <input type="checkbox" name="fri_chk" id="chkRfri" /></td>
                        <td width="79">Friday</td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td width="250" height="35" align="right">Preferred Date Range :</td>
            <td>&nbsp;</td>
            <td>
                <table width="367" border="0" cellpadding="0" cellspacing="0">
                    <tr>
                        <td width="118">
                            <input type="text" name="pref_txt" id="txtRpredatefrom" class="com" /></td>
                        <td width="19">&nbsp;</td>
                        <td width="216">
                            <input type="text" name="pref_txt" id="txtRpredateto" class="com" /></td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td width="250" height="33" align="right">Preferred Time :</td>
            <td>&nbsp;</td>
            <td>
                <select name="preft_com" id="cmbRprefTime" class="com">
                      <option value="0">12:00 am</option>
  <option value="1">1:00 am</option>
  <option value="2">2:00 am</option>
  <option value="3">3:00 am</option>
  <option value="4">4:00 am</option>
  <option value="5">5:00 am</option>
  <option value="6">6:00 am</option>
  <option value="7">7:00 am</option>
  <option value="8">8:00 am</option>
  <option value="9">9:00 am</option>
  <option value="10">10:00 am</option>
  <option value="11">11:00 am</option>
  <option value="12">12:00 pm</option>
  <option value="13">1:00 pm</option>
  <option value="14">2:00 pm</option>
  <option value="15">3:00 pm</option>
  <option value="16">4:00 pm</option>
  <option value="17">5:00 pm</option>
  <option value="18">6:00 pm</option>
  <option value="19">7:00 pm</option>
  <option value="20">8:00 pm</option>
  <option value="21">9:00 pm</option>
  <option value="22">10:00 pm</option>
  <option value="23">11:00 pm</option>
                </select></td>
        </tr>


    </table>


</div>
<!--End of popup of Request Referral button -->


<div id="containment-wrapper" style="border-bottom-style: none; border-top-style: none; border-right-style: none; border-left-width: 1px; border-left-color: rgb(166, 201, 226);">
     
    <div id="MessageHeaderGrid" name="MessageHeaderGrid" style="margin-top: -10px; border: 1px solid; border-color: rgb(166, 201, 226); height: 750px; overflow-x: auto;"
                class="ui-corner-all"  >
                <table class="box-table-a" id="tbl-Refferals" summary="Medications">
                    <thead>
                        <tr>
                            
                            
                            <th scope="col">
                                <div style="margin-left: 20px;">
                                    Provider
                                </div>
                            </th>
                            <th scope="col">
                                <div style="margin-left: 30px;">
                                    Facility
                                </div>
                            </th>
                            <th scope="col">
                                <div style="margin-left: 40px;">
                                    Request
                                </div>
                            </th>
                            <th scope="col">
                                <div style="margin-left: 80px;">
                                    Status
                                </div>
                            </th>
                            <th scope="col">
                                <div style="margin-left: 80px;">
                                    Message
                                </div>
                            </th>
                             <th scope="col">
                                <div style="margin-left: 90px; ">
                                    Details
                                </div>
                            </th>
                             
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Messages.Select((x, i) => new { PatientMessageModel = x, Index = i + 1 }))
                        {
                            if (item.PatientMessageModel.MessageType == "Referral Message")
                            {
                                StringBuilder jsonStringReferral = new StringBuilder();

                                jsonStringReferral.Append(" { ");
                                jsonStringReferral.Append("\"MessageId\": \"" + item.PatientMessageModel.MessageId + "\",");
                                jsonStringReferral.Append("\"FacilityId\": \"" + item.PatientMessageModel.FacilityId + "\",");
                                jsonStringReferral.Append("\"ProviderId_To\": \"" + item.PatientMessageModel.ProviderId_To + "\",");
                                jsonStringReferral.Append("\"PreferredPeriod\":  \"" + item.PatientMessageModel.PreferredPeriod + "\",");
                                jsonStringReferral.Append("\"MessageUrgencyId\":  \"" + (item.PatientMessageModel.MessageUrgencyId) + "\",");
                                jsonStringReferral.Append("\"PreferredWeekDay\":  \"" + item.PatientMessageModel.PreferredWeekDay + "\",");
                                jsonStringReferral.Append("\"AppointmentStart\":  \"" + item.PatientMessageModel.AppointmentStart + "\",");
                                jsonStringReferral.Append("\"AppointmentEnd\":  \"" + item.PatientMessageModel.AppointmentEnd + "\",");
                                jsonStringReferral.Append("\"PreferredTime\":  \"" + item.PatientMessageModel.PreferredTime + "\",");
                                jsonStringReferral.Append("\"VisitReason\":  \"" + item.PatientMessageModel.VisitReason + "\",");
                                jsonStringReferral.Append("\"MessageRequest\":  \"" + item.PatientMessageModel.MessageRequest + "\"");
                                jsonStringReferral.Append("}");
                                
                            <tr class="@((item.Index % 2 == 1) ? "r1" : "r0")" onclick="ReferralRequestDetail(@item.PatientMessageModel.MessageId);">
                                
                                
                                <td><input type="hidden" id="hdReferralDetails@(item.PatientMessageModel.MessageId)" value="@jsonStringReferral.ToString()" />
                                    <div style="margin-left: 20px;">
                                        @item.PatientMessageModel.ProviderName_To
                                    </div>
                                </td>
                                <td>
                                    <div style="margin-left: 30px;">
                                        @item.PatientMessageModel.FacilityName
                                    </div>
                                </td>

                                <td>
                                    <div style="margin-left:40px;">
                                        @item.PatientMessageModel.MessageType
                                    </div>
                                </td>
                                <td>
                                    <div style="margin-left: 80px;">
                                        @item.PatientMessageModel.MessageStatus
                                    </div>
                                </td>
                                <td>
                                    <div style="margin-left: 80px;">
                                        @item.PatientMessageModel.MessageRequest
                                    </div>
                                </td>
                                 <td>
                                   <div style="margin-left: 99px;" > <img src="Content/img/details.png" onclick="ReferralDetail(@item.PatientMessageModel.MessageId);"/>
                                      
                                    </div>
                                </td>
                               
                            </tr>
                            }
                        }
                    </tbody>
                </table>
            </div> 
</div>
